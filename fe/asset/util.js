define(function(require){function e(e,t){var n=Object.prototype.toString.call(t).slice(8,-1);return void 0!==t&&null!==t&&n===e}var $=require("jquery"),t={};return t={isArray:function(t){return e("Array",t)},isObject:function(t){return e("Object",t)},isString:function(t){return e("String",t)},isFunction:function(t){return e("Function",t)},getUniqueKey:function(){var e=(new Date).getTime().toString(),t=1;return function(){return e+t++}}(),indexOf:function(e,t){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;r>n;n++)if(t[n]===e)return n;return-1},inArray:function(e,n){return t.indexOf(e,n)>-1},easyTemplate:function(){var e=function(t,n){if(!t)return"";t!==e.template&&(e.template=t,e.aStatement=e.parsing(e.separate(t)));var r=e.aStatement,o=function(e){return e&&(n=e),arguments.callee};return o.toString=function(){return new Function(r[0],r[1])(n)},o};return e.separate=function(e){var t=/\\'/g,n=e.replace(/(<(\/?)#(.*?(?:\(.*?\))*)>)|(')|([\r\n\t])|(\$\{([^\}]*?)\})/g,function(e,n,r,o,i,u,a,f){return n?"{|}"+(r?"-":"+")+o+"{|}":i?"\\'":u?"":a?"'+("+f.replace(t,"'")+")+'":void 0});return n},e.parsing=function(e){var t,n,r,o,i,u,a=["var aRet = [];"];u=e.split(/\{\|\}/);for(var f=/\s/;u.length;)if(r=u.shift())if(i=r.charAt(0),"+"===i||"-"===i)switch(o=r.split(f),o[0]){case"+et":t=o[1],n=o[2],a.push('aRet.push("<!--'+t+' start-->");');break;case"-et":a.push('aRet.push("<!--'+t+' end-->");');break;case"+if":o.splice(0,1),a.push("if"+o.join(" ")+"{");break;case"+elseif":o.splice(0,1),a.push("}else if"+o.join(" ")+"{");break;case"-if":a.push("}");break;case"+else":a.push("}else{");break;case"+list":a.push("if("+o[1]+".constructor === Array){with({i:0,l:"+o[1]+".length,"+o[3]+"_index:0,"+o[3]+":null}){for(i=l;i--;){"+o[3]+"_index=(l-i-1);"+o[3]+"="+o[1]+"["+o[3]+"_index];");break;case"-list":a.push("}}}")}else r="'"+r+"'",a.push("aRet.push("+r+");");return a.push('return aRet.join("");'),[n,a.join("")]},e}(),str:{trim:function(e){if("string"!=typeof e)throw"trim need a string as parameter";for(var t=e.length,n=0,r=/(\u3000|\s|\t|\u00A0)/;t>n&&r.test(e.charAt(n));)n+=1;for(;t>n&&r.test(e.charAt(t-1));)t-=1;return e.slice(n,t)},decodeHTML:function(e){if("string"!=typeof e)throw"decodeHTML need a string as parameter";return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#39/g,"'").replace(/&nbsp;/g,"Â ").replace(/&#32/g," ").replace(/&amp;/g,"&")},encodeHTML:function(e){if("string"!=typeof e)throw"encodeHTML need a string as parameter";return e.replace(/\&/g,"&amp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\u00A0/g,"&nbsp;").replace(/(\u0020|\u000B|\u2028|\u2029|\f)/g,"&#32;")},bLength:function(e){if(!e)return 0;var t=e.match(/[^\x00-\xff]/g);return e.length+(t?t.length:0)}},obj:{objSup:function(e,t){for(var n={},r=0,o=t.length;o>r;r+=1){if("function"!=typeof e[t[r]])throw"super need function list  as the second paramsters";n[t[r]]=function(t){return function(){return t.apply(e,arguments)}}(e[t[r]])}return n},cut:function(e,n){var r={};if(!t.isArray(n))throw"Lilac.cut need array as second parameter";for(var o in e)t.inArray(o,n)||(r[o]=e[o]);return r}},json:{jsonToQuery:function(e,n){var r=function(e,n){return e=null==e?"":e,e=t.str.trim(e.toString()),n?encodeURIComponent(e):e},o=[];if("object"==typeof e)for(var i in e)if("$nullName"!==i)if(e[i]instanceof Array)for(var u=0,a=e[i].length;a>u;u++)o.push(i+"="+r(e[i][u],n));else"function"!=typeof e[i]&&o.push(i+"="+r(e[i],n));else o=o.concat(e[i]);return o.length?o.join("&"):""},queryToJson:function(e,n){for(var r=t.str.trim(e).split("&"),o={},i=function(e){return n?decodeURIComponent(e):e},u=0,a=r.length;a>u;u++)if(r[u]){var f=r[u].split("="),c=f[0],s=f[1];f.length<2&&(s=c,c="$nullName"),o[c]?(1!=t.isArray(o[c])&&(o[c]=[o[c]]),o[c].push(i(s))):o[c]=i(s)}return o}},dom:{parseDOM:function(e){for(var t in e)e[t]&&1==e[t].length&&(e[t]=e[t][0]);return e},builder:function(e,t){var n="string"==typeof e,r=e;n&&(r=document.createElement("div"),r.innerHTML=e);var o,i={};if(t)for(f in selectorList)i[f]=$(t[f].toString(),r);else{o=$("[node-type]",r);for(var u=0,a=o.length;a>u;u+=1){var f=o[u].getAttribute("node-type");i[f]||(i[f]=[]),i[f].push(o[u])}}var c=e;if(n)for(c=document.createDocumentFragment();r.childNodes[0];)c.appendChild(r.childNodes[0]);return{box:c,list:i}},contains:function(e,t){if(e===t)return!1;if(e.compareDocumentPosition)return 16===(16&e.compareDocumentPosition(t));if(e.contains&&1===t.nodeType)return e.contains(t);for(;t=t.parentNode;)if(e===t)return!0;return!1},isNode:function(e){return void 0!=e&&Boolean(e.nodeName)&&Boolean(e.nodeType)}},evt:{custEvent:function(){var e="__custEventKey__",n=1,r={},o=function(t,n){var o="number"==typeof t?t:t[e];return o&&r[o]&&{obj:"string"==typeof n?r[o][n]:r[o],key:o}},i={},u=function(e,t,n,r,i){if(e&&"string"==typeof t&&n){var u=o(e,t);if(!u||!u.obj)throw"custEvent ("+t+") is undefined !";return u.obj.push({fn:n,data:r,once:i}),u.key}},a=function(e,t,n,r){var i=!0,u=function(){i=!1};if(e&&"string"==typeof t){var a,f=o(e,t);if(f&&(a=f.obj)){n="undefined"!=typeof n&&[].concat(n)||[];for(var c=a.length-1;c>-1&&a[c];c--){var s=a[c].fn,l=a[c].once;if(s&&s.apply)try{s.apply(e,[{obj:e,type:t,data:a[c].data,preventDefault:u}].concat(n)),l&&a.splice(c,1)}catch(p){throw"[error][custEvent]"+p.message,p.stack}}return i&&"function"==typeof r&&r(),f.key}}},f={define:function(t,o){if(t&&o){var i="number"==typeof t?t:t[e]||(t[e]=n++),u=r[i]||(r[i]={});o=[].concat(o);for(var a=0;a<o.length;a++)u[o[a]]||(u[o[a]]=[]);return i}},undefine:function(t,n){if(t){var o="number"==typeof t?t:t[e];if(o&&r[o])if(n){n=[].concat(n);for(var i=0;i<n.length;i++)n[i]in r[o]&&delete r[o][n[i]]}else delete r[o]}},add:function(e,t,n,r){return u(e,t,n,r,!1)},once:function(e,t,n,r){return u(e,t,n,r,!0)},remove:function(e,n,r){if(e){var i,u=o(e,n);if(u&&(i=u.obj)){if(t.isArray(i))if(r){for(var a=0;i[a]&&i[a].fn!==r;)a++;i.splice(a,1)}else i.splice(0,i.length);else for(var a in i)i[a]=[];return u.key}}},fire:function(e,t,n,r){return a(e,t,n,r)},hook:function(t,o,u){if(t&&o&&u){var c,s,l=[],p=t[e],v=p&&r[p],g=o[e]||(o[e]=n++);if(v){s=i[p+"_"+g]||(i[p+"_"+g]={});var d=function(e){var t=!0;a(o,s[e.type].type,Array.prototype.slice.apply(arguments,[1,arguments.length]),function(){t=!1}),t&&e.preventDefault()};for(var h in u){var y=u[h];s[h]||(c=v[h])&&(c.push({fn:d,data:void 0}),s[h]={fn:d,type:y},l.push(y))}f.define(o,l)}}},unhook:function(t,n,r){if(t&&n&&r){var o=t[e],u=n[e],a=i[o+"_"+u];if(a)for(var c in r){{r[c]}a[c]&&f.remove(t,c,a[c].fn)}}},destroy:function(){r={},n=1,i={}}};return f}(),getEvent:function(){return document.addEventListener?function(){var e,t=arguments.callee;do if(e=t.arguments[0],e&&(e.constructor==Event||e.constructor==MouseEvent||e.constructor==KeyboardEvent))return e;while(t=t.caller);return e}:function(){return window.event}}(),hitTest:function(e,n){function r(e){var t=$(e)[0],n=$(t).position(),r={left:n.left,top:n.top,right:n.left+t.offsetWidth,bottom:n.top+t.offsetHeight};return r}var o=r(e);if(null==n)n=t.evt.getEvent();else{if(1==n.nodeType){var i=r(n);return o.right>i.left&&o.left<i.right&&o.bottom>i.top&&o.top<i.bottom?!0:!1}if(null==n.clientX)throw"evt.hitTest: ["+n+":oEvent] is not a valid value"}var u=n.clientX+$(document).scrollLeft(),a=n.clientY+$(document).scrollTop();return u>=o.left&&u<=o.right&&a>=o.top&&a<=o.bottom}}}});