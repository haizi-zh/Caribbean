define(function(require){function e(){var e=$(document).height();o.$cityBg.css("height",e+"px")}var $=require("jquery"),t=require("util"),n=require("widget/cookie/main");n.remove("__curBgImg__"),n.set("__curBgImg__","url(/images/city/lundun.jpg)",{encode:!1});var o={};o.$cityBg=$("#city-bg"),o.$cityList=$("#city-list");var i,a=o.$cityBg.css("background-image");e(),$(window).on("resize",function(){e()}),o.$cityList.delegate("[action-type=change-bg]","mouseenter",function(e){var s=e.currentTarget,r=$(s),c=t.json.queryToJson(r.attr("action-data"));i=setTimeout(function(){if(c.img){a=a.substring(a.lastIndexOf("/")+1),a=a.substring(0,a.lastIndexOf("."));var e="url("+c.img+")",t=e.substring(e.lastIndexOf("/")+1);t=t.substring(0,t.lastIndexOf(".")),a!=t&&o.$cityBg.animate({opacity:.7},{duration:300,queue:!1,complete:function(){o.$cityBg.css("background-image",e),n.set("__curBgImg__",e,{encode:!1}),o.$cityBg.animate({opacity:1},{duration:300,queue:!1,complete:function(){}})}})}},300),e.stopPropagation(),e.preventDefault()}),o.$cityList.delegate("[action-type=change-bg]","mouseleave",function(){i&&clearTimeout(i)})});