define(function(require){function t(t){var e=function(t,e){for(var n,i=(t+";"+e).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4");i&&(n=i.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i));)i=i.replace(n[1]+n[2]+n[3],"");return i};t=t||"";var n=[],i={push:function(t,e){return n.push(t+":"+e),i},remove:function(t){for(var e=0;e<n.length;e++)0==n[e].indexOf(t+":")&&n.splice(e,1);return i},getStyleList:function(){return n.slice()},getCss:function(){return e(t,n.join(";"))}};return i}function e(e,n,i){function o(){return"none"!=e.css("display")}function a(t){t=p.isArray(t)?t:[0,0];for(var e=0;2>e;e++)"number"!=typeof t[e]&&(t[e]=0);return t}function r(e,n,i){if(o()){var a,r,s,c,l="fixed",u=e.offsetWidth,d=e.offsetHeight,p=$(window).width(),m=$(window).height(),v=0,g=0,h=t(e.style.cssText);if(f)switch(a=c=i[1],r=s=i[0],n){case"lt":c=s="";break;case"lb":a=s="";break;case"rt":r=c="";break;case"rb":a=r="";break;case"c":default:a=(m-d)/2+i[1],r=(p-u)/2+i[0],c=s=""}else{switch(l="absolute",v=a=$(window).scrollTop(),g=r=$(window).scrollLeft(),n){case"lt":a+=i[1],r+=i[0];break;case"lb":a+=m-d-i[1],r+=i[0];break;case"rt":a+=i[1],r+=p-u-i[0];break;case"rb":a+=m-d-i[1],r+=p-u-i[0];break;case"c":default:a+=(m-d)/2+i[1],r+=(p-u)/2+i[0]}s=c=""}"c"==n&&(v>a&&(a=v),g>r&&(r=g)),h.push("position",l).push("top",a+"px").push("left",r+"px").push("right",s+"px").push("bottom",c+"px"),e.style.cssText=h.getCss()}}function s(t){t=t||window.event,p.evt.custEvent.fire(u,"beforeFix",t.type),!v||f&&"c"!=c||r(d,c,l)}var c,l,u,d=e[0],f=!(y||"CSS1Compat"!==document.compatMode&&Lilac.browser.IE),m=/^(c)|(lt)|(lb)|(rt)|(rb)$/,v=!0;if(p.dom.isNode(d)&&m.test(n)){var g={getNode:function(){return d},isFixed:function(){return v},setFixed:function(t){return(v=!!t)&&r(d,c,l),this},setAlign:function(t,e){return m.test(t)&&(c=t,l=a(e),v&&r(d,c,l)),this},destroy:function(){f||$(window).off("scroll",s),$(window).off("resize",s),p.evt.custEvent.undefine(u)}};return u=p.evt.custEvent.define(g,"beforeFix"),g.setAlign(n,i),f||$(window).on("scroll",s),$(window).on("resize",s),g}}function n(t){var e;return(e=t.getAttribute(h))||t.setAttribute(h,e=p.getUniqueKey()),">"+t.tagName.toLowerCase()+"["+h+'="'+e+'"]'}function i(){l||(l=$("<div></div>"));var n="<div>";y&&(n+='<div style="position:absolute;width:100%;height:100%;"></div>'),n+="</div>",l=$.parseHTML(n)[0],document.body.appendChild(l),g=!0,u=e($(l),"lt"),d=function(){var e=$(window).width(),n=$(window).height();l.style.cssText=t(l.style.cssText).push("width",e+"px").push("height",n+"px").getCss()},$(window).on("resize",d),p.evt.custEvent.add(u,"beforeFix",d),d()}function o(t){var e=function(t){var e={};return"none"==t.style.display?(t.style.visibility="hidden",t.style.display="",e.w=t.offsetWidth,e.h=t.offsetHeight,t.style.display="none",t.style.visibility="visible"):(e.w=t.offsetWidth,e.h=t.offsetHeight),e},n=function(t,n){n=n||"topleft";var i=null;if("none"==t.style.display?(t.style.visibility="hidden",t.style.display="",i=$(t).position(),t.style.display="none",t.style.visibility="visible"):i=$(t).position(),"topleft"!==n){var o=e(t);"topright"===n?i.l=i.l+o.w:"bottomleft"===n?i.t=i.t+o.h:"bottomright"===n&&(i.l=i.l+o.w,i.t=i.t+o.h)}return i},i=p.dom.builder(t),o=i.list.outer[0],a=i.list.inner[0],r=p.getUniqueKey(),s={},c=p.evt.custEvent.define(s,"show");p.evt.custEvent.define(c,"hide");var l=null;return s.show=function(){return o.style.display="",p.evt.custEvent.fire(c,"show"),s},s.hide=function(){return o.style.display="none",p.evt.custEvent.fire(c,"hide"),s},s.getPosition=function(t){return n(o,t)},s.getSize=function(t){return(t||!l)&&(l=e.apply(s,[o])),l},s.html=function(t){return void 0!==t&&(a.innerHTML=t),a.innerHTML},s.text=function(t){return void 0!==text&&(a.innerHTML=p.str.encodeHTML(t)),p.str.decodeHTML(a.innerHTML)},s.appendChild=function(t){return a.appendChild(t),s},s.getUniqueID=function(){return r},s.getOuter=function(){return o},s.getInner=function(){return a},s.getParentNode=function(){return o.parentNode},s.getDomList=function(){return i.list},s.getDomListByKey=function(t){return i.list[t]},s.getDom=function(t,e){return i.list[t]?i.list[t][e||0]:!1},s}function a(t,e){if(!t)throw"createModuleDialog need template as first parameter";var n,i,a,r,s,c,l,u,d,f,m=function(){n=$.extend({t:null,l:null,width:null,height:null},e),i=o(t,n),r=i.getOuter(),s=i.getDom("title"),c=i.getDom("inner"),l=i.getDom("close"),$(l).on("click",function(t){return t.preventDefault(),d(),!1})};return m(),f=p.obj.objSup(i,["show","hide"]),d=function(t){return"function"!=typeof u||t||u()!==!1?(f.hide(),p.dom.contains(document.body,i.getOuter())&&document.body.removeChild(i.getOuter()),a):!1},a=i,a.show=function(){return p.dom.contains(document.body,i.getOuter())||document.body.appendChild(i.getOuter()),f.show(),a},a.hide=d,a.setPosition=function(t){return r.style.top=t.t+"px",r.style.left=t.l+"px",a},a.setMiddle=function(){var t=$(window).width(),e=$(window).height(),n=i.getSize(!0),o=$(document).scrollTop()+(e-n.h)/2;return r.style.top=0>o?0:o+"px",r.style.left=(t-n.w)/2+"px",a},a.setTitle=function(t){return s.innerHTML=t,a},a.setContent=function(t){return"string"==typeof t?c.innerHTML=t:c.appendChild(t),a},a.clearContent=function(){for(;c.children.length;)$(c.children[0]).remove();return a},a.setBeforeHideFn=function(t){u=t},a.clearBeforeHideFn=function(){u=null},a}function r(t){var e,n=['<div class="W_layer" node-type="outer" style="display:none;position:absolute;z-index:10001">','<div class="bg">','<table border="0" cellspacing="0" cellpadding="0">',"<tbody>","<tr>","<td>",'<div class="content">','<div class="title" node-type="title">','<span node-type="title_content"></span>',"</div>",'<a href="javascript:void(0);" class="W_close" title="关闭" node-type="close"></a>','<div node-type="inner"></div>',"</div>","</td>","</tr>","</tbody>","</table>","</div>","</div>"].join(""),i=function(){var t=a(e.template);return e.isMask&&(p.evt.custEvent.add(t,"show",function(){b.showUnderNode(t.getOuter())}),p.evt.custEvent.add(t,"hide",function(){b.back(),t.setMiddle()})),e.isDrag&&f.drag(t.getDom("title"),{actObj:t,moveDom:t.getOuter()}),t.destroy=function(){o(t);try{t.hide(!0)}catch(e){}},t},o=function(t){t.setTitle("").clearContent()};e=$.extend({template:n,isHold:!1,isMask:!0,isDrag:!0},t);var r=e.isHold;e=p.obj.cut(e,["isHold"]);var s=i();return r||p.evt.custEvent.add(s,"hide",function(){p.evt.custEvent.remove(s,"hide",arguments.callee),o(s)}),s}function s(t,e){var n,i,a,r,e=$.extend({hideCallback:function(){},type:"succM",msg:"",timeout:""},e),s=e.template||'<#et temp data><div class="W_layer" node-type="outer"><div class="bg"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content layer_mini_info_big" node-type="inner"><p class="clearfix"><span class="icon_${data.type}"></span>${data.msg}&nbsp; &nbsp; &nbsp;</p></div></td></tr></tbody></table></div></div></#et>',c=p.easyTemplate(s,{type:e.type,msg:t}).toString();n={},i=o(c),r=i.getOuter(),p.evt.custEvent.add(i,"hide",function(){b.hide(),e.hideCallback&&e.hideCallback(),p.evt.custEvent.remove(i,"hide",arguments.callee),clearTimeout(a)}),p.evt.custEvent.add(i,"show",function(){document.body.appendChild(r),b.showUnderNode(r)}),i.show(),e.timeout&&(a=setTimeout(i.hide,e.timeout));var l=$(window).width(),u=$(window).height(),d=i.getSize(!0);return r.style.top=$(document).scrollTop()+(u-d.h)/2+"px",r.style.left=(l-d.w)/2+"px",n.layer=i,n}function c(t){var e='<div class="detail"><div class="clearfix"><div><p>{{msg}}</p></div><div class="btn"><a class="W_btn_a" href="javascript:void(0);" node-type="cancel_btn"><span>确认</span></a></div></div></div>',n=w.compile(e).render({msg:t}),i=r();i.setTitle("提示"),i.setContent(n),i.show(),i.setMiddle();var o=p.dom.parseDOM(p.dom.builder(i.getInner()).list);$(o.cancel_btn).on("click",function(){i.destroy()})}var l,u,d,$=require("jquery"),p=require("util"),f=require("widget/drag/main"),m=$.browser,v=[],g=!1,h="Lilac-Mask-Key",y=function(){return m.msie&&parseInt(m.version,10)<=6}(),b={getNode:function(){return l},show:function(t,e){return g?(t=$.extend({opacity:.3,background:"#000000"},t),l.style.background=t.background,$(l).css("opacity",t.opacity),l.style.display="",u.setAlign("lt"),e&&e()):(i(),b.show(t,e)),b},hide:function(){return l.style.display="none",nowIndex=void 0,v=[],b},showUnderNode:function(t,e){return p.dom.isNode(t)&&b.show(e,function(){$(l).css("zIndex",$(t).css("zIndex"));var e=n(t),i=p.indexOf(v,e);-1!=i&&v.splice(i,1),v.push(e),$(t).before($(l))}),b},back:function(){if(v.length<1)return b;var t,e;return v.pop(),v.length<1?b.hide():(e=v[v.length-1])&&(t=$(e,document.body)[0])?($(l).css("zIndex",$(t).css("zIndex")),$(t).before($(l))):b.back(),b},destroy:function(){p.evt.custEvent.remove(u),$(window).off("resize",d),l.style.display="none",lastNode=void 0,_cache={}}},w=require("hogan");return{createModulePopup:r,litePrompt:s,alertPopup:c}});