define(function(require){function e(e,t){return t?n.str.bLength(e):e.length}function t(e){return e=new String(e),e=e.indexOf(".")>-1?parseFloat(e):parseInt(e,10),isNaN(e)?0:e}var $=require("jquery"),n=require("util"),o=require("register/config"),i=require("widget/popup/main"),a={email:function(e){return/\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/i.test(e)},moreThan:function(n,o,i,a){i=i||"string",i=i.toLowerCase(),void 0===a&&(a=!0);var r="string"==i?e(n,a):t(n);return r>=o},lessThan:function(n,o,i,a){i=i||"string",i=i.toLowerCase(),void 0===a&&(a=!0);var r="string"==i?e(n,a):t(n);return o>=r},range:function(e,t,n,o,i){return o=o||"string",o=o.toLowerCase(),void 0===i&&(i=!0),a.moreThan(e,t,o,i)&&a.lessThan(e,n,o,i)}},r={};r.$register=$("#reg-register"),r.$nickName=$("#reg-nickname"),r.$nickNameTips=$("#nickname-tips"),r.$email=$("#reg-email"),r.$emailTips=$("#email-tips"),r.$passwd=$("#reg-passwd"),r.$passwdTips=$("#passwd-tips"),r.$repasswd=$("#reg-repasswd"),r.$repasswdTips=$("#repasswd-tips");var s=!1,c=!1,l=!1,d=!1;r.$nickName.focus(function(){r.$nickNameTips.html("4~30个字符组成")}).blur(function(){var e=n.str.trim(r.$nickName.val());e?a.range(e,4,30)?(r.$nickNameTips.html(""),s=!0):(r.$nickNameTips.html('<em style="color: red">昵称为4~30位</em>'),s=!1):(r.$nickNameTips.html('<em style="color: red">请输入昵称</em>'),s=!1)}),r.$email.blur(function(){var e=n.str.trim(r.$email.val());r.$emailTips.html(""),e?a.email(e)?(r.$emailTips.html(""),c=!0):(r.$emailTips.html('<em style="color: red">请输入正确的邮箱</em>'),c=!1):(r.$emailTips.html('<em style="color: red">请输入邮箱</em>'),c=!1)}),r.$passwd.focus(function(){r.$passwdTips.html("6~16个字符组成，区分大小写")}).blur(function(){var e=n.str.trim(r.$passwd.val());e?a.range(e,6,16)?(r.$passwdTips.html(""),l=!0):(r.$passwdTips.html('<em style="color: red">密码为6~16位</em>'),l=!1):(r.$passwdTips.html('<em style="color: red">请输入密码</em>'),l=!1)}),r.$repasswd.focus(function(){r.$repasswdTips.html("重复密码要与密码一致")}).blur(function(){var e=n.str.trim(r.$repasswd.val());e?e!=n.str.trim(r.$passwd.val())?(r.$repasswdTips.html('<em style="color: red">重复密码要与密码一致</em>'),d=!1):(r.$repasswdTips.html(""),d=!0):(r.$repasswdTips.html('<em style="color: red">请输入重复密码</em>'),d=!1)}),r.$register.on("click",function(e){var t=window.location.search.slice(1),a=n.json.queryToJson(t,!0);s&&c&&l&&d&&$.ajax({type:"POST",url:o.AJAX.ADDUSER,dataType:"json",data:{uname:n.str.trim(r.$nickName.val()),email:n.str.trim(r.$email.val()),passwd:n.str.trim(r.$passwd.val())},success:function(e){200!=e.code?(errorMsg=e.msg,i.alertPopup(errorMsg)):i.litePrompt("注册成功！",{timeout:1500,hideCallback:function(){setTimeout(function(){window.location.href=decodeURIComponent(a.source_url)},20)}})}}),e.stopPropagation(),e.preventDefault()})});