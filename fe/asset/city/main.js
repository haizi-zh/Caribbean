define(function(require){function e(){var e=t.json.queryToJson(i.$tabList.find(".cur").attr("action-data"));n.setParams(e),$("#page_container_adapter").delegate("[action-type=changePageAdapter]","click",function(e){var t=e.currentTarget,n=$(t);"next"===n.attr("node-type")?$("[action-type=changePage]")[1].click():$("[action-type=changePage]")[0].click()})}var $=require("jquery"),t=require("util"),n=require("widget/pager/main"),o=require("city/config"),i=($.browser,{});i.$shopContent=$("#shop_content"),i.$tabContainer=$("#tab_container"),i.$tabList=$(".tab_list");var a=$("[action-type=choose_key]",i.$shopContent),s=$("[action-type=change_tab]",i.$tabContainer);i.$shopContent.delegate("[action-type=choose_key]","click",function(e){for(var n=e.currentTarget,i=$(n),s=a.length-1;s>=0;s--)$(a[s]).removeClass("cur");i.addClass("cur"),$.ajax({type:"get",url:o.AJAX.GET_BRAND,dataType:"json",data:t.json.queryToJson(i.attr("action-data")),success:function(e){$("#toggle_list").html(e.html)}}),e.stopPropagation(),e.preventDefault()}),i.$shopContent.delegate("[action-type=brand]","click",function(n){var i=n.currentTarget,a=$(i),r=t.json.queryToJson(a.attr("action-data"));$.ajax({type:"get",url:o.AJAX.GET_SHOP_BY_TAB,dataType:"json",data:r,success:function(n){$("[node-type=show]",$("#page_container")).html(1),$("[node-type=all]",$("#page_container")).html(n.page_cnt);for(var o,i={},a=s.length-1;a>=0;a--)o=$(s[a]),0!=a?o.removeClass("cur"):o.addClass("cur"),i=$.extend(t.json.queryToJson(o.attr("action-data")),r),o.attr("action-data",t.json.jsonToQuery(i));$("#shop_list").html(n.html),e()}}),n.stopPropagation(),n.preventDefault()}),i.$tabContainer.delegate("[action-type=change_tab]","click",function(i){var a=i.currentTarget,r=$(a),c=t.json.queryToJson(r.attr("action-data"));$.ajax({type:"get",url:o.AJAX.GET_SHOP_BY_TAB,dataType:"json",data:c,success:function(t){c.allPages=t.page_cnt,c.page=1,n.setParams(c),$("[node-type=show]",$("#page_container")).html(1),$("[node-type=all]",$("#page_container")).html(t.page_cnt);for(var o=s.length-1;o>=0;o--)$(s[o]).removeClass("cur");r.addClass("cur"),$("#shop_list").html(t.html),e()}}),i.stopPropagation(),i.preventDefault()}),n.initialize("page_container","shop_list",o.AJAX.GET_SHOP_BY_TAB,e),e();var r=require("widget/fixedable/main");r.addEl("tab_container")});